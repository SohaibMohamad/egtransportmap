<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Egypt Transport Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: 'Rubik', sans-serif;
    }

    body.dark {
      background: #121212;
      color: #eee;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    .glass {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .logo-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1003;
    }

    .logo-container img {
      max-height: 100px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.6);
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .top-right-buttons {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1002;
    }

    .top-right-buttons button {
      padding: 8px 14px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      border-radius: 10px;
    }

    .icon-menu {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: grid;
      grid-template-columns: repeat(3, 50px);
      gap: 10px;
      z-index: 1002;
      padding: 10px;
    }

    .icon-menu button {
      width: 50px;
      height: 50px;
      font-size: 22px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.3);
      cursor: pointer;
    }

    .menu-panel {
      position: absolute;
      bottom: 90px;
      left: 20px;
      width: 320px;
      height: 255px;
      display: none;
      flex-direction: column;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      z-index: 1003;
      overflow: hidden;
    }

    .menu-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      font-weight: bold;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }

    .close-btn {
      background: #e53935;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 16px;
      cursor: pointer;
    }

    .search-box {
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
      width: calc(100% - 24px);
      margin: 6px auto;
      display: block;
    }

    .menu-content-panel {
      flex: 1;
      overflow-y: auto;
      padding: 8px 10px;
    }

    details {
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 6px;
      margin-bottom: 6px;
    }

    summary {
      font-weight: 500;
      cursor: pointer;
      font-size: 14px;
    }

    .route-card {
      background: rgba(255, 255, 255, 0.7);
      padding: 8px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .route-btn {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .route-btn button {
      flex: 1;
      padding: 6px;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    .pin-btn {
      width: 35px;
      background: #ff9800;
    }

    .pin-btn.pinned {
      background: #4caf50;
    }

    .like-btn {
      width: 35px;
      background: #e91e63;
    }

    .route-description {
      font-size: 12px;
      color: black;
      direction: rtl;
    }

    .menu-content-panel::-webkit-scrollbar {
      width: 6px;
    }

    .menu-content-panel::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      .menu-panel {
        width: 90%;
        left: 5%;
      }
    }
  </style>
</head>
<body>

<div class="logo-container">
  <img src="A6VKOY3fhn0O0jaKpdAT--1--o1p35-removebg-preview.png" alt="Egypt Transport Map Logo" />
</div>

<div id="map"></div>

<div class="top-right-buttons glass">
  <button onclick="locateMe()">üìç Locate Me</button>
  <button onclick="toggleTheme()">üåó Theme</button>
</div>

<div class="icon-menu glass">
  <button onclick="openMenu('bus')">üöå</button>
  <button onclick="openMenu('metro')">üöá</button>
  <button onclick="openMenu('brt')">üöç</button>
  <button onclick="openMenu('cta')">üöÜ</button>
</div>

<div class="menu-panel" id="menu-panel">
  <div class="menu-header-bar">
    <span id="menu-title">Transport</span>
    <button class="close-btn" onclick="closeMenu()">√ó</button>
  </div>
  <input type="text" class="search-box" placeholder="Search..." oninput="filterRoutes(this.value)" />
  <div class="menu-content-panel" id="menu-content-panel"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([30.0444, 31.2357], 11);
  const lightLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
  const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');
  lightLayer.addTo(map);

  const routes = {
    bus1: [[30.01, 31.1], [30.02, 31.12], [30.03, 31.14]],
    bus2: [[30.04, 31.11], [30.05, 31.13], [30.06, 31.15]],
    bus3: [[30.07, 31.16], [30.08, 31.17]],
    metro1: [[30.05, 31.2], [30.06, 31.22], [30.07, 31.24]],
    brt1: [[30.01, 31.18], [30.03, 31.2], [30.05, 31.23]],
    cta1: [[30.02, 31.19], [30.04, 31.22], [30.06, 31.25]]
  };

  const colors = {
    bus1: 'green',
    bus2: 'green',
    bus3: 'goldenrod',
    metro1: 'purple',
    brt1: 'orange',
    cta1: 'blue'
  };

  const routeData = {
    bus: {
      'Green Bus': [
        { id: 'bus1', name: 'G1', color: 'green', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ÿπÿ®ÿßÿ≥ ÿßŸÑÿπŸÇÿßÿØ, ÿßŸÑÿ¨Ÿäÿ≤ÿ©, ÿ≤ŸàŸäŸÑ' },
        { id: 'bus2', name: 'G2', color: 'green', description: 'ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±, ÿ≤ŸÖÿßŸÑŸÉ, ÿ£ŸÉÿ™Ÿàÿ®ÿ±, ÿßŸÑŸÖÿπÿßÿØŸä' }
      ],
      'Yellow Bus': [
        { id: 'bus3', name: 'Y1', color: 'goldenrod', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    metro: {
      'Line 1': [
        { id: 'metro1', name: 'Main Metro', color: 'purple', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    brt: {
      'Express Route': [
        { id: 'brt1', name: 'Line A', color: 'orange', description: 'ÿ£ŸÉÿ™Ÿàÿ®ÿ±, ÿ≤ÿßŸäÿØ, ÿßŸÑÿØŸÇŸä, Ÿàÿ≥ÿ∑ ÿßŸÑÿ®ŸÑÿØ' }
      ]
    },
    cta: {
      'Main Line': [
        { id: 'cta1', name: 'CTA 1', color: 'blue', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' }
      ]
    }
  };

  let pinnedRoutes = {};
  let activeRoute = null;
  let activeRouteLayer = null;

  function showSingleRoute(key) {
    if (activeRoute && !pinnedRoutes[activeRoute] && activeRouteLayer) {
      map.removeLayer(activeRouteLayer);
    }
    const color = colors[key];
    if (!pinnedRoutes[key]) {
      activeRouteLayer = L.polyline(routes[key], {
        color,
        weight: 5,
        className: 'active-route'
      }).addTo(map);
      activeRoute = key;
      map.fitBounds(activeRouteLayer.getBounds());
    }
  }

  function togglePin(btn, key) {
    const pinned = btn.classList.toggle("pinned");
    if (pinned) {
      const color = colors[key];
      const line = L.polyline(routes[key], {
        color,
        weight: 5,
        className: 'active-route'
      }).addTo(map);
      pinnedRoutes[key] = line;
    } else {
      map.removeLayer(pinnedRoutes[key]);
      delete pinnedRoutes[key];
    }
  }

  function openMenu(type) {
  const titleMap = {
    bus: 'üöå Bus',
    metro: 'üöá Metro',
    brt: 'üöç BRT',
    cta: 'üöÜ CTA Lines'
  };

  document.getElementById('menu-title').textContent = titleMap[type];
  document.getElementById('menu-panel').style.display = 'flex';

  renderRoutes(type); // Initial render

  // Update routes on input
  document.querySelector('.search-box').oninput = (e) => {
    renderRoutes(type, e.target.value);
  };
}

function renderRoutes(type, filter = '') {
  const contentPanel = document.getElementById('menu-content-panel');
  contentPanel.innerHTML = '';
  const data = routeData[type];

  for (const category in data) {
    const groupMatches = category.toLowerCase().includes(filter.toLowerCase());
    const routes = data[category];

    const matchedRoutes = routes.filter(route =>
      route.name.toLowerCase().includes(filter.toLowerCase()) ||
      route.description.toLowerCase().includes(filter.toLowerCase())
    );

    // Skip this group if it doesn't match and has no matching children
    if (!groupMatches && matchedRoutes.length === 0) continue;

    const details = document.createElement('details');
    details.open = true;

    const summary = document.createElement('summary');
    summary.textContent = category;
    details.appendChild(summary);

    (groupMatches ? routes : matchedRoutes).forEach(route => {
      const card = document.createElement('div');
      card.className = 'route-card';
      card.setAttribute('data-name', route.name.toLowerCase());
      card.setAttribute('data-description', route.description.toLowerCase());

      const btnRow = document.createElement('div');
      btnRow.className = 'route-btn';

      const routeBtn = document.createElement('button');
      routeBtn.textContent = route.name;
      routeBtn.style.background = route.color;
      routeBtn.onclick = () => showSingleRoute(route.id);

      const pinBtn = document.createElement('button');
      pinBtn.textContent = 'üìå';
      pinBtn.className = 'pin-btn';
      pinBtn.onclick = () => togglePin(pinBtn, route.id);

      const likeBtn = document.createElement('button');
      likeBtn.textContent = '‚ù§Ô∏è';
      likeBtn.className = 'like-btn';
      likeBtn.onclick = () => toggleLike(route); // Optional if you're using likes

      btnRow.appendChild(routeBtn);
      btnRow.appendChild(pinBtn);
      btnRow.appendChild(likeBtn);

      const desc = document.createElement('div');
      desc.className = 'route-description';
      desc.textContent = route.description;

      card.appendChild(btnRow);
      card.appendChild(desc);
      details.appendChild(card);
    });

    contentPanel.appendChild(details);
  }
  
  
    navigator.geolocation.getCurrentPosition(pos => {
      const { latitude, longitude } = pos.coords;
      L.marker([latitude, longitude]).addTo(map).bindPopup("You are here").openPopup();
      map.setView([latitude, longitude], 14);
    }, () => {
      alert("Unable to retrieve location.");
    });
  }
  function closeMenu() {
  document.getElementById('menu-panel').style.display = 'none';
}

function locateMe() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported.");
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude } = pos.coords;
    L.marker([latitude, longitude]).addTo(map).bindPopup("You are here").openPopup();
    map.setView([latitude, longitude], 14);
  }, () => {
    alert("Unable to retrieve location.");
  });

function toggleTheme() {
  document.body.classList.toggle("dark");
  if (document.body.classList.contains("dark")) {
    map.removeLayer(lightLayer);
    darkLayer.addTo(map);
  } else {
    map.removeLayer(darkLayer);
    lightLayer.addTo(map);
  }
}
  
</script>
</body>
</html>
