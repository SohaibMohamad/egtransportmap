<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Egypt Transport Map</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: 'Rubik', sans-serif;
    }

    body.dark {
      background: #121212;
      color: #eee;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    .glass {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .logo-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1003;
    }

    .logo-container img {
      max-height: 100px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.6);
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .top-right-buttons {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1002;
    }

    .top-right-buttons button {
      padding: 8px 14px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      border-radius: 10px;
    }

    .icon-menu {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: grid;
      grid-template-columns: repeat(3, 50px);
      gap: 10px;
      z-index: 1002;
      padding: 10px;
    }

    .icon-menu button {
      width: 50px;
      height: 50px;
      font-size: 22px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.3);
      cursor: pointer;
    }

    .menu-panel {
      position: absolute;
      bottom: 90px;
      left: 20px;
      width: 320px;
      height: 255px;
      display: none;
      flex-direction: column;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      z-index: 1003;
      overflow: hidden;
    }

    .menu-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      font-weight: bold;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }

    .close-btn {
      background: #e53935;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 16px;
      cursor: pointer;
    }

    .search-box {
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
      width: calc(100% - 24px);
      margin: 6px auto;
      display: block;
    }

    .menu-content-panel {
      flex: 1;
      overflow-y: auto;
      padding: 8px 10px;
    }

    details {
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 6px;
      margin-bottom: 6px;
    }

    summary {
      font-weight: 500;
      cursor: pointer;
      font-size: 14px;
    }

    .route-card {
      background: rgba(255, 255, 255, 0.7);
      padding: 8px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .route-btn {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .route-btn button {
      flex: 1;
      padding: 6px;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    .pin-btn {
      width: 35px;
      background: #ff9800;
    }

    .pin-btn.pinned {
      background: #4caf50;
    }

    .like-btn {
      width: 35px;
      background: #e91e63;
    }

    .route-description {
      font-size: 12px;
      color: black;
      direction: rtl;
    }

    .menu-content-panel::-webkit-scrollbar {
      width: 6px;
    }

    .menu-content-panel::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    @media (max-width: 768px) {
      .menu-panel {
        width: 90%;
        left: 5%;
      }
    }
  </style>
</head>
<body>

<div class="logo-container">
  <img src="A6VKOY3fhn0O0jaKpdAT--1--o1p35-removebg-preview.png" alt="Egypt Transport Map Logo" />
</div>

<div id="map"></div>

<div class="top-right-buttons glass">
  <button onclick="locateMe()">üìç Locate Me</button>
  <button onclick="toggleTheme()">üåó Theme</button>
</div>

<div class="icon-menu glass">
  <button onclick="openMenu('bus')">üöå</button>
  <button onclick="openMenu('metro')">üöá</button>
  <button onclick="openMenu('brt')">üöç</button>
  <button onclick="openMenu('cta')">üöÜ</button>
</div>

<div class="menu-panel" id="menu-panel">
  <div class="menu-header-bar">
    <span id="menu-title">Transport</span>
    <button class="close-btn" onclick="closeMenu()">√ó</button>
  </div>
  <input type="text" class="search-box" placeholder="Search..." oninput="filterRoutes(this.value)" />
  <div class="menu-content-panel" id="menu-content-panel"></div>
</div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const map = L.map('map').setView([30.0444, 31.2357], 11);
  const lightLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
  const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');
  lightLayer.addTo(map);

  const routes = {
    bus1: [[31.03048, 29.92432
31.03745, 29.9288
31.03916, 29.92912
31.04192, 29.93076
31.04263, 29.93178
31.04339, 29.93243
31.044, 29.9322
31.0445, 29.9323
31.0445, 29.93278
31.04449, 29.93322
31.05054, 29.93731
31.05736, 29.94171
31.06191, 29.94469
31.0645, 29.94632
31.06667, 29.94775
31.06816, 29.94874
31.07102, 29.9506
31.07606, 29.95398
31.07864, 29.95573
31.08104, 29.95448
31.09143, 29.95013
31.09919, 29.94696
31.10165, 29.94595
31.10334, 29.94444
31.102, 29.9437
31.10126, 29.94474
31.10469, 29.95125
31.10831, 29.95875
31.10906, 29.96468
31.10868, 29.97035
31.11044, 29.97443
31.11541, 29.97924
31.12176, 29.98244
31.12686, 29.98676
31.1303, 29.98788
31.13377, 29.98661
31.13545, 29.9848
31.14117, 29.98709
31.14026, 29.98834
31.13645, 29.98957
31.13515, 29.99009
31.13561, 29.99048
31.1386, 29.99146
31.14116, 29.99205
31.14372, 29.99244
31.14622, 29.99313
31.14861, 29.99431
31.15026, 29.99502
31.15336, 29.99612
31.15788, 29.99768
31.16085, 29.99879
31.16384, 29.99986
31.16677, 30.00103
31.17002, 30.00225
31.17257, 30.00323
31.17594, 30.00452
31.18023, 30.00617
31.18387, 30.0076
31.18846, 30.00936
31.19027, 30.01003
31.19353, 30.01135
31.19831, 30.01318
31.20051, 30.01426
31.20247, 30.01477
31.2043, 30.01474
31.20568, 30.01449
31.20704, 30.01438
31.20882, 30.0146
31.2103, 30.01483
31.21187, 30.01527
31.21202, 30.01539
31.21211, 30.01554
31.21215, 30.01573
31.21203, 30.01673
31.2117, 30.0195
31.21138, 30.02242
31.21089, 30.02596
31.21139, 30.02752
31.21492, 30.02797
31.2171, 30.02841
31.21893, 30.02848
31.22226, 30.0284
31.22611, 30.02824
31.22654, 30.02818
31.22665, 30.02816
31.22673, 30.02818
31.22691, 30.02831
31.2312, 30.04977
31.23146, 30.04692
31.23137, 30.04145
31.22923, 30.03508
31.22959, 30.03065
31.22929, 30.02893
31.22657, 30.0284
31.22017, 30.02858
31.21561, 30.02842
31.21324, 30.02784
31.21142, 30.02789
31.21076, 30.02641
31.2119, 30.01643
31.20901, 30.01467
31.20623, 30.01414
31.2051, 30.0147
31.20296, 30.01496
31.19922, 30.01379
31.20309, 30.01477
31.20611, 30.0143
31.21241, 30.01531
31.21488, 30.01714
31.21081, 30.01506
31.20762, 30.01435
31.20559, 30.01437
31.20393, 30.01497
31.19871, 30.01367
31.19259, 30.01114
31.1839, 30.00774
31.16579, 30.00078
31.15937, 29.99842
31.15124, 29.99548
31.14678, 29.99353
31.1398, 29.99185
31.13151, 29.99094
31.12944, 29.99003
31.12686, 29.98726
31.12226, 29.98309
31.11392, 29.97858
31.10867, 29.97127
31.10872, 29.96584
31.10665, 29.95677
31.10296, 29.94878
31.10014, 29.94821
31.09529, 29.94877
31.07256, 29.95834
31.06652, 29.95792
31.07217, 29.95796
31.07699, 29.95584
31.07234, 29.95167
31.04404, 29.93337
31.04288, 29.93322
31.04191, 29.93139
31.03918, 29.92937
31.03359, 29.92654
31.32974, 30.0404
31.32974, 30.0403
31.32981, 30.04025
31.32992, 30.04026
31.32998, 30.04031
31.32993, 30.04046
31.32923, 30.04369
31.32822, 30.04802
31.32753, 30.05099
31.32673, 30.05543
31.3264, 30.05774
31.32583, 30.06166
31.32533, 30.06524
31.3252, 30.06678
31.32872, 30.06767
31.33363, 30.06817
31.33587, 30.06842
31.336, 30.0686
31.3354, 30.06863
31.33307, 30.06834
31.32514, 30.06753
31.31916, 30.06684
31.31373, 30.06434
31.30745, 30.06106
31.30445, 30.05952
31.30265, 30.05921
31.30108, 30.06163
31.29946, 30.06296
31.29833, 30.06373
31.29401, 30.06703
31.29236, 30.06847
31.29149, 30.06931
31.28935, 30.07048
31.28752, 30.07167
31.28561, 30.07297
31.28527, 30.0735
31.28504, 30.07436
31.28387, 30.07522
31.2817, 30.07696
31.27944, 30.07748
31.27646, 30.07641
31.27292, 30.07461
31.27013, 30.07229
31.26676, 30.06967
31.26515, 30.06867
31.26324, 30.06787
31.26004, 30.06676
31.25669, 30.06537
31.2535, 30.06414
31.24916, 30.0624
31.2464, 30.06136
31.24528, 30.06124
31.24223, 30.0583
31.2407, 30.05682
31.23843, 30.05468
31.23608, 30.05237
31.23359, 30.05043
31.23148, 30.04995]],
    bus2: [[30.04, 31.11], [30.05, 31.13], [30.06, 31.15]],
    bus3: [[30.07, 31.16], [30.08, 31.17]],
    metro1: [[30.05, 31.2], [30.06, 31.22], [30.07, 31.24]],
    brt1: [[30.01, 31.18], [30.03, 31.2], [30.05, 31.23]],
    cta1: [[30.02, 31.19], [30.04, 31.22], [30.06, 31.25]]
  };

  const colors = {
    bus1: 'green',
    bus2: 'green',
    bus3: 'goldenrod',
    metro1: 'purple',
    brt1: 'orange',
    cta1: 'blue'
  };

  const routeData = {
    bus: {
      'Green Bus': [
        { id: 'bus1', name: 'G1', color: 'green', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ÿπÿ®ÿßÿ≥ ÿßŸÑÿπŸÇÿßÿØ, ÿßŸÑÿ¨Ÿäÿ≤ÿ©, ÿ≤ŸàŸäŸÑ' },
        { id: 'bus2', name: 'G2', color: 'green', description: 'ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±, ÿ≤ŸÖÿßŸÑŸÉ, ÿ£ŸÉÿ™Ÿàÿ®ÿ±, ÿßŸÑŸÖÿπÿßÿØŸä' }
      ],
      'Yellow Bus': [
        { id: 'bus3', name: 'Y1', color: 'goldenrod', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    metro: {
      'Line 1': [
        { id: 'metro1', name: 'Main Metro', color: 'purple', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    brt: {
      'Express Route': [
        { id: 'brt1', name: 'Line A', color: 'orange', description: 'ÿ£ŸÉÿ™Ÿàÿ®ÿ±, ÿ≤ÿßŸäÿØ, ÿßŸÑÿØŸÇŸä, Ÿàÿ≥ÿ∑ ÿßŸÑÿ®ŸÑÿØ' }
      ]
    },
    cta: {
      'Main Line': [
        { id: 'cta1', name: 'CTA 1', color: 'blue', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' }
      ]
    }
  };

  let pinnedRoutes = {};
  let activeRoute = null;
  let activeRouteLayer = null;

  function showSingleRoute(key) {
    if (activeRoute && !pinnedRoutes[activeRoute] && activeRouteLayer) {
      map.removeLayer(activeRouteLayer);
    }
    const color = colors[key];
    if (!pinnedRoutes[key]) {
      activeRouteLayer = L.polyline(routes[key], {
        color,
        weight: 5,
        className: 'active-route'
      }).addTo(map);
      activeRoute = key;
      map.fitBounds(activeRouteLayer.getBounds());
    }
  }

  function togglePin(btn, key) {
    const pinned = btn.classList.toggle("pinned");
    if (pinned) {
      const color = colors[key];
      const line = L.polyline(routes[key], {
        color,
        weight: 5,
        className: 'active-route'
      }).addTo(map);
      pinnedRoutes[key] = line;
    } else {
      map.removeLayer(pinnedRoutes[key]);
      delete pinnedRoutes[key];
    }
  }

  function openMenu(type) {
  const titleMap = {
    bus: 'üöå Bus',
    metro: 'üöá Metro',
    brt: 'üöç BRT',
    cta: 'üöÜ CTA Lines'
  };

  document.getElementById('menu-title').textContent = titleMap[type];
  document.getElementById('menu-panel').style.display = 'flex';

  renderRoutes(type); // Initial render

  // Update routes on input
  document.querySelector('.search-box').oninput = (e) => {
    renderRoutes(type, e.target.value);
  };
}

function renderRoutes(type, filter = '') {
  const contentPanel = document.getElementById('menu-content-panel');
  contentPanel.innerHTML = '';
  const data = routeData[type];

  for (const category in data) {
    const groupMatches = category.toLowerCase().includes(filter.toLowerCase());
    const routes = data[category];

    const matchedRoutes = routes.filter(route =>
      route.name.toLowerCase().includes(filter.toLowerCase()) ||
      route.description.toLowerCase().includes(filter.toLowerCase())
    );

    // Skip this group if it doesn't match and has no matching children
    if (!groupMatches && matchedRoutes.length === 0) continue;

    const details = document.createElement('details');
    details.open = true;

    const summary = document.createElement('summary');
    summary.textContent = category;
    details.appendChild(summary);

    (groupMatches ? routes : matchedRoutes).forEach(route => {
      const card = document.createElement('div');
      card.className = 'route-card';
      card.setAttribute('data-name', route.name.toLowerCase());
      card.setAttribute('data-description', route.description.toLowerCase());

      const btnRow = document.createElement('div');
      btnRow.className = 'route-btn';

      const routeBtn = document.createElement('button');
      routeBtn.textContent = route.name;
      routeBtn.style.background = route.color;
      routeBtn.onclick = () => showSingleRoute(route.id);

      const pinBtn = document.createElement('button');
      pinBtn.textContent = 'üìå';
      pinBtn.className = 'pin-btn';
      pinBtn.onclick = () => togglePin(pinBtn, route.id);

      const likeBtn = document.createElement('button');
      likeBtn.textContent = '‚ù§Ô∏è';
      likeBtn.className = 'like-btn';
      likeBtn.onclick = () => toggleLike(route); // Optional if you're using likes

      btnRow.appendChild(routeBtn);
      btnRow.appendChild(pinBtn);
      btnRow.appendChild(likeBtn);

      const desc = document.createElement('div');
      desc.className = 'route-description';
      desc.textContent = route.description;

      card.appendChild(btnRow);
      card.appendChild(desc);
      details.appendChild(card);
    });

    contentPanel.appendChild(details);
  }
  
  }
  function closeMenu() {
  document.getElementById('menu-panel').style.display = 'none';
}

function locateMe() {
  if (!navigator.geolocation) {
    alert("Geolocation not supported.");
    return;
  }
  navigator.geolocation.getCurrentPosition(pos => {
    const { latitude, longitude } = pos.coords;
    L.marker([latitude, longitude]).addTo(map).bindPopup("You are here").openPopup();
    map.setView([latitude, longitude], 14);
  }, () => {
    alert("Unable to retrieve location.");
  });
}
function toggleTheme() {
  document.body.classList.toggle("dark");
  if (document.body.classList.contains("dark")) {
    map.removeLayer(lightLayer);
    darkLayer.addTo(map);
  } else {
    map.removeLayer(darkLayer);
    lightLayer.addTo(map);
  }
}
  
</script>
</body>
</html>
