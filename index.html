<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Egypt Transport Map</title>
<!-- Styles omitted for brevity, same as previous but include modal styles -->
<style>
  /* ... (keep previous styles) ... */
  /* Additional styles for modals */
  .modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
  }
  .modal-content {
    background-color: #fff;
    margin: 10% auto;
    padding: 20px;
    border-radius: 12px;
    width: 80%;
    max-height: 70%;
    overflow-y: auto;
  }
  .close {
    float: right;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
  }
</style>
</head>
<body>

<!-- Existing content (logo, map, buttons, etc.) remains unchanged -->

<!-- Modals for detailed info and From-To results -->
<div id="routeStopsModal" class="modal">
  <div class="modal-content" id="routeStopsContent">
    <span class="close" onclick="closeRouteStops()">&times;</span>
    <h3>Route Stops</h3>
    <div id="routeStopsList"></div>
  </div>
</div>

<div id="fromToModal" class="modal">
  <div class="modal-content" id="fromToContent">
    <span class="close" onclick="closeFromTo()">&times;</span>
    <h3>Matching Routes for From-To</h3>
    <div id="fromToResults"></div>
  </div>
</div>

<!-- Rest of your existing layout remains unchanged -->

<!-- Scripts -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Map initialization (same as previous)
  const map = L.map('map').setView([30.0444, 31.2357], 11);
  const lightLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
  const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');
  lightLayer.addTo(map);

  // Your route data (same as before)...
  const routeData = {
    /* ... your data ... */
  };

  // Utility functions (find route by id, get route color, etc.)
  function showSingleRoute(id) {
    // For demo, no actual route lines. You can implement route drawing here.
    console.log('Show route on map:', id);
  }

  function getRouteById(id) {
    for (const type in routeData) {
      for (const group in routeData[type]) {
        for (const route of routeData[type][group]) {
          if (route.id === id) return route;
        }
      }
    }
  }

  // ----------- Show "Transport" menu and render routes (same as previous) ---------
  // ... (existing code for menu rendering) ...

  // ----------- Search info in route.info (same as previous) -----------
  function searchInfo(query) {
    const resultRoutes = [];
    if (!query.trim()) {
      console.log("Empty search, skipping.");
      return;
    }
    const terms = query.trim().split('-').map(t => t.trim());

    for (const type in routeData) {
      for (const group in routeData[type]) {
        for (const route of routeData[type][group]) {
          if (!route.info) continue;
          const infoStops = route.info.split('-').map(s => s.trim());

          let i = 0; // index in infoStops
          let matched = true;

          for (let j = 0; j < terms.length; j++) {
            const term = terms[j];
            let found = false;

            while (i < infoStops.length) {
              if (infoStops[i].includes(term)) {
                found = true;
                i++;
                break;
              }
              i++;
            }

            if (!found) {
              matched = false;
              break;
            }
          }

          if (matched) {
            resultRoutes.push(route);
          }
        }
      }
    }
    showInfoSearchResults(resultRoutes);
  }

  // ----------- Show search results with "ℹ️ Route Stops" buttons ---------
  function showInfoSearchResults(routes) {
    let panel = document.getElementById('info-results');
    panel.style.display = 'block';
    panel.innerHTML = '';

    if (routes.length === 0) {
      panel.innerHTML = '<div>No matching routes found.</div>';
      return;
    }

    routes.forEach(route => {
      const card = document.createElement('div');
      card.style.padding = '10px';
      card.style.marginBottom = '10px';
      card.style.border = `2px solid ${route.color}`;
      card.style.borderRadius = '8px';
      card.style.background = '#f9f9f9';
      card.style.cursor = 'pointer';

      // Route name and info button
      const headerDiv = document.createElement('div');
      headerDiv.style.display = 'flex';
      headerDiv.style.justifyContent = 'space-between';
      headerDiv.style.alignItems = 'center';

      const nameDiv = document.createElement('div');
      nameDiv.style.fontWeight = 'bold';
      nameDiv.style.fontSize = '15px';
      nameDiv.style.color = route.color;
      nameDiv.textContent = route.name;

      const infoBtn = document.createElement('button');
      infoBtn.textContent = 'ℹ️ Stops';
      infoBtn.style.padding = '4px 8px';
      infoBtn.style.border = 'none';
      infoBtn.style.borderRadius = '6px';
      infoBtn.style.background = '#007bff';
      infoBtn.style.color = 'white';
      infoBtn.style.cursor = 'pointer';

      infoBtn.onclick = () => showRouteStops(route);

      headerDiv.appendChild(nameDiv);
      headerDiv.appendChild(infoBtn);

      // Direction info
      const stops = route.info ? route.info.split('-').map(s => s.trim()) : [];
      const directionDiv = document.createElement('div');
      directionDiv.style.fontSize = '12px';
      directionDiv.style.color = '#555';
      directionDiv.style.marginTop = '6px';
      if (stops.length > 0) {
        directionDiv.innerHTML = `Direction: ${stops[0]} ➡️ ${stops[stops.length - 1]}`;
      } else {
        directionDiv.innerHTML = `Direction: N/A`;
      }

      // Price info if available
      if (route.price) {
        const priceDiv = document.createElement('div');
        priceDiv.innerHTML = `<div style="font-size: 13px; color: #555; margin-top: 4px;">Price: <strong>${route.price}</strong></div>`;
        card.appendChild(priceDiv);
      }

      // Assemble card
      card.appendChild(headerDiv);
      card.appendChild(directionDiv);

      // On click, show route map
      card.onclick = () => {
        showSingleRoute(route.id);
        document.getElementById('info-results').style.display = 'none';
      };

      panel.appendChild(card);
    });
  }

  function showRouteStops(route) {
    document.getElementById('routeStopsList').innerHTML = '';
    if (route.info) {
      const stops = route.info.split('-').map(s => s.trim());
      stops.forEach(stop => {
        const div = document.createElement('div');
        div.textContent = stop;
        div.style.padding = '4px 0';
        document.getElementById('routeStopsList').appendChild(div);
      });
    } else {
      document.getElementById('routeStopsList').innerHTML = '<div>No stops info available.</div>';
    }
    document.getElementById('routeStopsModal').style.display = 'block';
  }

  function closeRouteStops() {
    document.getElementById('routeStopsModal').style.display = 'none';
  }

  // ----------- From-To search and modal ---------
  function searchFromTo() {
    const from = document.getElementById('from-input').value.trim();
    const to = document.getElementById('to-input').value.trim();
    const modal = document.getElementById('fromToModal');
    const resultsDiv = document.getElementById('fromToResults');
    resultsDiv.innerHTML = '';

    if (!from || !to) {
      resultsDiv.innerHTML = '<div>Please enter both "From" and "To".</div>';
      modal.style.display = 'block';
      return;
    }

    // Find routes that include 'from' and 'to'
    const matchingRoutes = [];
    const allRoutes = [];
    for (const type in routeData) {
      for (const group in routeData[type]) {
        for (const route of routeData[type][group]) {
          if (route.info) {
            const stops = route.info.split('-').map(s => s.trim());
            allRoutes.push({ route, stops });
          }
        }
      }
    }

    // Find routes that contain 'from' and 'to' in sequence
    for (const { route, stops } of allRoutes) {
      const fromIdx = stops.findIndex(s => s.includes(from));
      const toIdx = stops.findIndex(s => s.includes(to));
      if (fromIdx !== -1 && toIdx !== -1 && fromIdx < toIdx) {
        matchingRoutes.push(route);
      }
    }

    // Also find routes connected to 'to' (for "go to" places)
    const connectedRoutes = new Set();
    for (const { route, stops } of allRoutes) {
      if (stops.includes(to)) {
        connectedRoutes.add(route);
      }
    }

    // Show matching routes
    if (matchingRoutes.length > 0) {
      matchingRoutes.forEach(r => {
        const div = createRouteCardDiv(r);
        resultsDiv.appendChild(div);
      });
    } else {
      resultsDiv.innerHTML = '<div>No direct route from "From" to "To".</div>';
    }

    // Show modal
    modal.style.display = 'block';

    function createRouteCardDiv(route) {
      const div = document.createElement('div');
      div.style.border = '1px solid #ccc';
      div.style.borderRadius = '8px';
      div.style.padding = '8px';
      div.style.marginBottom = '6px';
      div.style.cursor = 'pointer';

      div.innerHTML = `
        <div style="font-weight: bold; color: ${route.color}; font-size: 15px;">${route.name}</div>
        <div style="font-size: 13px;">${route.description}</div>
        <div style="font-size: 12px; margin-top: 4px;">Stops: ${route.info}</div>
      `;
      div.onclick = () => {
        showSingleRoute(route.id);
        closeFromTo();
      };
      return div;
    }
  }

  function closeFromTo() {
    document.getElementById('fromToModal').style.display = 'none';
  }

  // You can enhance the search for "connect to" places as needed

  // Utility to close modals on outside click
  window.onclick = (event) => {
    const modal1 = document.getElementById('routeStopsModal');
    const modal2 = document.getElementById('fromToModal');
    if (event.target === modal1) closeRouteStops();
    if (event.target === modal2) closeFromTo();
  };

  // Other functions like toggle theme, locate, menu, etc., remain unchanged.
  // ...
</script>
</body>
</html>
