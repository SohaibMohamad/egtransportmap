<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Egypt Transport Map</title>
  <link rel="icon" type="image/png" sizes="256x256" href="A6VKOY3fhn0O0jaKpdAT--1--o1p35-removebg-preview-modified.png" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500&display=swap" rel="stylesheet" />
  <style>
    html, body {
      margin: 0;
      height: 100%;
      font-family: 'Rubik', sans-serif;
    }

    body.dark {
      background: #121212;
      color: #eee;
    }

    #map {
      height: 100%;
      width: 100%;
    }

    .glass {
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .logo-container {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      z-index: 1003;
    }

    .logo-container img {
      max-height: 100px;
      padding: 6px 12px;
      background: rgba(255,255,255,0.6);
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.15);
    }

    .top-right-buttons {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 1000;
      width: 240px;
    }

    .input-wrapper {
      position: relative;
      display: flex;
      flex-direction: column;
    }

    .input-wrapper input {
      padding: 6px 28px 6px 8px;
      font-size: 14px;
      border-radius: 8px;
      border: 1px solid #ccc;
      margin-bottom: 4px;
    }

    .input-wrapper button.clear-btn {
      position: absolute;
      right: 6px;
      top: 6px;
      background: none;
      border: none;
      font-size: 16px;
      cursor: pointer;
      padding: 0;
    }

    .action-button {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 8px;
      background: #007bff;
      color: white;
      border: none;
      cursor: pointer;
      width: 100%;
    }

    .result-panel {
      position: absolute;
      right: 20px;
      width: 280px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      z-index: 999;
      display: none;
    }

    .top-right-buttons button {
      padding: 8px 14px;
      font-size: 14px;
      border: none;
      cursor: pointer;
      border-radius: 10px;
    }

    .icon-menu {
      position: absolute;
      bottom: 20px;
      left: 20px;
      display: grid;
      grid-template-columns: repeat(3, 50px);
      gap: 10px;
      z-index: 1002;
      padding: 10px;
    }

    .icon-menu button {
      width: 50px;
      height: 50px;
      font-size: 22px;
      border: none;
      border-radius: 10px;
      background: rgba(255, 255, 255, 0.3);
      cursor: pointer;
    }

    .menu-panel {
      position: absolute;
      bottom: 90px;
      left: 20px;
      width: 320px;
      height: 255px;
      display: none;
      flex-direction: column;
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
      z-index: 1003;
      overflow: hidden;
    }

    .menu-header-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 14px;
      font-weight: bold;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
      border-top-left-radius: 12px;
      border-top-right-radius: 12px;
    }

    .close-btn {
      background: #e53935;
      color: white;
      border: none;
      border-radius: 50%;
      width: 28px;
      height: 28px;
      font-size: 16px;
      cursor: pointer;
    }

    .search-box {
      padding: 6px 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 13px;
      width: calc(100% - 24px);
      margin: 6px auto;
      display: block;
    }

    .menu-content-panel {
      flex: 1;
      overflow-y: auto;
      padding: 8px 10px;
    }

    details {
      background: #fafafa;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 6px;
      margin-bottom: 6px;
    }

    summary {
      font-weight: 500;
      cursor: pointer;
      font-size: 14px;
    }

    .route-card {
      background: rgba(255, 255, 255, 0.7);
      padding: 8px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-top: 6px;
    }

    .route-btn {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .route-btn button {
      flex: 1;
      padding: 6px;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    .pin-btn {
      width: 35px;
      background: #ff9800;
    }

    .pin-btn.pinned {
      background: #4caf50;
    }

    .like-btn {
      width: 35px;
      background: #e91e63;
    }

    .route-description {
      font-size: 12px;
      color: black;
      direction: rtl;
    }

    .menu-content-panel::-webkit-scrollbar {
      width: 6px;
    }

    .menu-content-panel::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    .like-btn.liked {
     background: #a31545;
    }
  </style>
</head>
<body>

<div class="logo-container">
  <img src="A6VKOY3fhn0O0jaKpdAT--1--o1p35-removebg-preview.png" alt="Egypt Transport Map Logo" />
</div>

<div id="map"></div>

<div class="top-right-buttons glass">
  <button onclick="locateMe()">üìç Locate Me</button>
  <button onclick="toggleTheme()">üåó Theme</button>
  <button onclick="showLikedRoutes()">‚ù§Ô∏è Liked Routes</button>
  <!-- Search Input -->
  <div class="input-wrapper" id="search-wrapper">
    <input type="text" id="info-search-box" placeholder="üîç Search Places..." oninput="searchInfo(this.value)">
    <button class="clear-btn" onclick="clearSearch()">‚úñ</button>
  </div>
  <!-- From-To Inputs -->
  <div class="input-wrapper" id="fromto-wrapper">
    <input type="text" id="from-input" placeholder="From...">
    <input type="text" id="to-input" placeholder="To...">
    <button class="clear-btn" onclick="clearFromTo()" style="top: 34px;">‚úñ</button>
  </div>
  <button class="action-button" onclick="searchFromTo()">üöè From-To Route</button>
</div>

<!-- Search Results -->
<div class="result-panel" id="info-results" style="top: 190px;"></div>

<!-- From-To Results -->
<div class="result-panel" id="from-to-result-panel" style="top: 280px;">
  <div style="display: flex; justify-content: space-between; align-items: center;">
    <strong>Matching Routes</strong>
    <button onclick="document.getElementById('from-to-result-panel').style.display='none'" 
            style="background: none; border: none; font-size: 16px; cursor: pointer;">‚úñ</button>
  </div>
  <div id="from-to-result-content" style="margin-top: 8px;"></div>
</div>

<!-- Icon Menu -->
<div class="icon-menu glass">
  <button onclick="openMenu('bus')"><img src="pbus.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('brt')"><img src="brt.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('cta')"><img src="buss.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('metro')"><img src="metro2.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('tram')"><img src="tram.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('mini')"><img src="mini.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('micro')"><img src="micro.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('monorail')"><img src="mono2.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('hst')"><img src="hst.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
  <button onclick="openMenu('lrt')"><img src="lrt.png" alt="Bus" style="width: 30px; height: 30px;" /></button>
</div>

<!-- Menu Panel -->
<div class="menu-panel" id="menu-panel">
  <div class="menu-header-bar">
    <span id="menu-title">Transport</span>
    <button class="close-btn" onclick="closeMenu()">√ó</button>
  </div>
  <input type="text" class="search-box" placeholder="Search..." oninput="filterRoutes(this.value)" />
  <div class="menu-content-panel" id="menu-content-panel"></div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  // Initialize Map
  const map = L.map('map').setView([30.0444, 31.2357], 11);
  const lightLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png');
  const darkLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png');
  lightLayer.addTo(map);

  let likedRoutes = {};
  let pinnedRoutes = {};
  let activeRoute = null;
  let activeRouteLayer = null;

  // Sample route data (same as your data, truncated for brevity)
  const routeData = {
    bus: {
      'Green Bus': [
        { id: 'bus1', name: 'G1', color: '#006400', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ÿπÿ®ÿßÿ≥ ÿßŸÑÿπŸÇÿßÿØ, ÿßŸÑÿ¨Ÿäÿ≤ÿ©, ÿ≤ŸàŸäŸÑ', info:'ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ± - ŸÅŸäÿµŸÑ - ÿßŸÑŸáÿ±ŸÖ - ÿ≠ÿØÿßÿ¶ŸÇ ÿßŸÑÿ£Ÿáÿ±ÿßŸÖ - ÿ≤ŸàŸäŸÑ', price: '10 EGP' },
        { id: 'bus2', name: 'G2', color: '#006400', description: 'ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ±, ÿ≤ŸÖÿßŸÑŸÉ, ÿ£ŸÉÿ™Ÿàÿ®ÿ±, ÿßŸÑŸÖÿπÿßÿØŸä', info:'ÿßŸÑÿ™ÿ≠ÿ±Ÿäÿ± - ÿßŸÑŸáÿ±ŸÖ - ÿßŸÑÿ±ŸÖÿßŸäÿ© - ÿ≠ÿØÿßÿ¶ŸÇ ÿßŸÑÿ£Ÿáÿ±ÿßŸÖ', price: '12 EGP' }
      ],
      'Orange Bus': [
        { id: 'bus3', name: 'O', color: 'orange', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '15 EGP' }
      ],
      'Mwaslat Masr': [
        { id: 'mbusz1', name: 'Zayed1', color: '#74C9DB', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '8 EGP' },
        { id: 'mbusz2', name: 'Zayed2', color: '#86C53F', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '8 EGP' },
        { id: 'mbusz3', name: 'Zayed3', color: '#B453A0', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '8 EGP' },
        { id: 'mbusz4', name: 'Zayed4', color: '#6175B5', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '8 EGP' },
        { id: 'mbusz5', name: 'Zayed5', color: '#CB3366', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '8 EGP' },
        { id: 'mbusz6', name: 'Zayed6', color: '#C9CB2E', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '8 EGP' },
        { id: 'mbusz7', name: 'Zayed7', color: '#639A3C', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '8 EGP' },
        { id: 'mbuso1', name: '10th of Ramadan1', color: '#E51C6A', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '10 EGP' },
        { id: 'mbuso2', name: '10th of Ramadan2', color: '#665150', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '10 EGP' },
        { id: 'mbuso3', name: '10th of Ramadan3', color: '#6854A5', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '10 EGP' },
        { id: 'mbuso4', name: '10th of Ramadan4', color: '#93C63F', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '10 EGP' },
        { id: 'bus221', name: 'M22 Cairo University', color: '#7FFF00', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '12 EGP' },
        { id: 'bus222', name: 'M22 Hadayek October', color: '#7FFF00', description: 'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', info:'ÿ¥ÿ®ÿ±ÿß, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿπÿ≤ÿ®ÿ© ÿßŸÑŸÜÿÆŸÑ, ÿßŸÑŸÖÿ±ÿ¨', price: '12 EGP' }
      ]
    },
    brt: {
      'Express Route': [
        { id: 'brt1', name: 'Line A', color: 'orange', description: 'ÿ£ŸÉÿ™Ÿàÿ®ÿ±, ÿ≤ÿßŸäÿØ, ÿßŸÑÿØŸÇŸä, Ÿàÿ≥ÿ∑ ÿßŸÑÿ®ŸÑÿØ', price: '20 EGP' }
      ]
    },
    cta: {
      'CTA 1111': [
        { id: 'cta1a', name: 'Third Settlement', color: '#8B0000', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' },
        { id: 'cta1b', name: 'Shubra', color: '#8B0000', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' }
      ],
      'CTA 810': [
        { id: 'cta2a', name: 'Hadayek El-Quba', color: '#4B0082', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' },
        { id: 'cta2b', name: 'Omrania', color: '#4B0082', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' }
      ],
      'CTA 65': [
        { id: 'cta3a', name: 'Old Cairo', color: '#696969', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' },
        { id: 'cta3b', name: '8th District, Nasr City', color: '#696969', description: 'ÿ±ŸÖÿ≥Ÿäÿ≥, ŸÖÿµÿ± ÿßŸÑÿ¨ÿØŸäÿØÿ©, ÿßŸÑŸÖÿ∑ÿ±Ÿäÿ©, ÿßŸÑÿπÿßÿ¥ÿ±' }
      ]
    },
    metro: {
      'Cairo': [
        { id: 'metro1', name: 'Line 1', color: 'blue', description: 'ÿßŸÑŸÖÿ±ÿ¨, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑÿ≥ÿßÿØÿßÿ™, ÿ≠ŸÑŸàÿßŸÜ' },
        { id: 'metro2', name: 'Line 2', color: 'red', description: 'ÿ¥ÿ®ÿ±ÿß ÿßŸÑÿÆŸäŸÖÿ©, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑÿ≥ÿßÿØÿßÿ™, ÿßŸÑŸÖŸÜŸäÿ®' },
        { id: 'metro3', name: 'Line 3', color: 'green', description: 'ÿπÿØŸÑŸä ŸÖŸÜÿµŸàÿ±, ÿßŸÑÿπÿ®ÿßÿ≥Ÿäÿ©, ŸÜÿßÿµÿ±, ÿ¨ÿßŸÖÿπÿ© ÿßŸÑŸÇÿßŸáÿ±ÿ©' },
        { id: 'metro33', name: 'Line 3 Imbabah Branch', color: 'green', description: 'ÿπÿØŸÑŸä ŸÖŸÜÿµŸàÿ±, ÿßŸÑÿπÿ®ÿßÿ≥Ÿäÿ©, ŸÜÿßÿµÿ±, ÿ¨ÿßŸÖÿπÿ© ÿßŸÑŸÇÿßŸáÿ±ÿ©' },
        { id: 'metro4', name: 'Line 4', color: 'purple', description: 'ÿπÿØŸÑŸä ŸÖŸÜÿµŸàÿ±, ÿßŸÑÿπÿ®ÿßÿ≥Ÿäÿ©, ŸÜÿßÿµÿ±, ÿ¨ÿßŸÖÿπÿ© ÿßŸÑŸÇÿßŸáÿ±ÿ©' }
      ],
      'Alexandria': [
        { id: 'metroa', name: 'Main Metro', color: '#6495ED', description: 'ÿ¥ÿ®ÿ±ÿß ÿßŸÑÿÆŸäŸÖÿ©, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑÿ≥ÿßÿØÿßÿ™, ÿßŸÑŸÖŸÜŸäÿ®' }
      ]
    },
    tram: {
      'Main': [
        { id: 'tram1', name: 'Main Route', color: '#D2691E', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ],
      'Sidi Gaber Branch': [
        { id: 'tram2', name: 'Branch', color: '#D2691E', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ],
      'El-Fath st. Branch': [
        { id: 'tram3', name: 'Branch', color: '#D2691E', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    mini: {
      'Line 1': [
        { id: 'minia1', name: 'From Zenen to Rehab Gate 6', color: '#00CED1', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' },
        { id: 'minia2', name: 'From Rehab Gate 6 to Zenen', color: '#00CED1', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    micro: {
      'Line 1': [
        { id: 'micro1', name: 'Microbus', color: 'blue', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    monorail: {
      'Nile East': [
        { id: 'mono1', name: 'Monorail', color: '#009ABD', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ],
      'Nile West': [
        { id: 'mono2', name: 'Monorail', color: '#CF0B23', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    hst: {
      'Main': [
        { id: 'hst1', name: 'HST', color: '#00008B', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ],
      'Alexandria Branch': [
        { id: 'hst2', name: 'HST', color: '#00008B', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    },
    lrt: {
      'Main': [
        { id: 'lrt1', name: 'LRT', color: '#B8860B', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ],
      '10th of Ramadan Branch': [
        { id: 'lrt2', name: 'LRT', color: '#B8860B', description: 'ÿ≠ŸÑŸàÿßŸÜ, ÿßŸÑÿ≥ŸäÿØÿ© ÿ≤ŸäŸÜÿ®, ÿßŸÑÿ¥ŸáÿØÿßÿ°, ÿßŸÑŸÖÿ±ÿ¨' }
      ]
    }
  };

  // Functions for map and route control
  function showSingleRoute(key) {
    if (activeRoute && !pinnedRoutes[activeRoute] && activeRouteLayer) {
      map.removeLayer(activeRouteLayer);
    }
    const color = getRouteColorById(key);
    // For demo, no actual route lines, just fit to bounds
    // You can implement route drawing here
    activeRoute = key;
  }

  function getRouteColorById(id) {
    // Loop through routeData to find color by id
    for (const type in routeData) {
      for (const group in routeData[type]) {
        for (const route of routeData[type][group]) {
          if (route.id === id) return route.color;
        }
      }
    }
    return 'blue';
  }

  function togglePin(btn, key) {
    const pinned = btn.classList.toggle("pinned");
    // Implement pinning routes if needed
  }

  function openMenu(type) {
    const titleMap = {
      bus: 'üöå Bus',
      metro: 'üöá Metro',
      brt: 'üöç BRT',
      cta: 'üöÜ CTA Lines',
      tram: 'üöã Tram Lines',
      mini: 'üöê Mini Bus Lines',
      micro: 'üöê Micro Bus Lines',
      monorail: 'üöù Monorail Lines',
      hst: 'üöÖ High-Speed-Train Lines',
      lrt: 'üöà Light-Rail-Train Lines',
    };

    document.getElementById('menu-title').textContent = titleMap[type];
    document.getElementById('menu-panel').style.display = 'flex';

    // Render routes initially
    renderRoutes(type);
    // Add input listener
    document.querySelector('.search-box').oninput = (e) => {
      renderRoutes(type, e.target.value);
    };
  }

  function closeMenu() {
    document.getElementById('menu-panel').style.display = 'none';
  }

  function renderRoutes(type, filter='') {
    const contentPanel = document.getElementById('menu-content-panel');
    contentPanel.innerHTML = '';
    const data = routeData[type];

    for (const category in data) {
      const groupMatches = category.toLowerCase().includes(filter.toLowerCase());
      const routesArray = data[category];

      const matchedRoutes = routesArray.filter(route =>
        route.name.toLowerCase().includes(filter.toLowerCase()) ||
        route.description.toLowerCase().includes(filter.toLowerCase())
      );

      if (!groupMatches && matchedRoutes.length === 0) continue;

      const details = document.createElement('details');
      details.open = true;

      const summary = document.createElement('summary');
      summary.textContent = category;
      details.appendChild(summary);

      (groupMatches ? routesArray : matchedRoutes).forEach(route => {
        const card = document.createElement('div');
        card.className = 'route-card';
        card.setAttribute('data-name', route.name.toLowerCase());
        card.setAttribute('data-description', route.description.toLowerCase());

        const btnRow = document.createElement('div');
        btnRow.className = 'route-btn';

        const routeBtn = document.createElement('button');
        routeBtn.textContent = route.name;
        routeBtn.style.background = route.color;
        routeBtn.onclick = () => showSingleRoute(route.id);

        const pinBtn = document.createElement('button');
        pinBtn.textContent = 'üìå';
        pinBtn.className = 'pin-btn';
        pinBtn.onclick = () => togglePin(pinBtn, route.id);

        const likeBtn = document.createElement('button');
        likeBtn.textContent = '‚ù§Ô∏è';
        likeBtn.className = 'like-btn';
        likeBtn.onclick = () => {
          toggleLike(route);
          likeBtn.classList.toggle('liked', !!likedRoutes[route.id]);
        };
        if (likedRoutes[route.id]) {
          likeBtn.classList.add('liked');
        }

        // Show price info if available
        const priceSpan = document.createElement('span');
        if (route.price) {
          priceSpan.textContent = `Price: ${route.price}`;
          priceSpan.style.fontSize = '12px';
          priceSpan.style.color = '#555';
          priceSpan.style.marginLeft = '8px';
        }

        btnRow.appendChild(routeBtn);
        btnRow.appendChild(pinBtn);
        btnRow.appendChild(likeBtn);
        if (route.price) {
          btnRow.appendChild(priceSpan);
        }

        const desc = document.createElement('div');
        desc.className = 'route-description';
        desc.textContent = route.description;

        card.appendChild(btnRow);
        card.appendChild(desc);
        details.appendChild(card);
      });

      contentPanel.appendChild(details);
    }
  }

  function toggleLike(route) {
    if (likedRoutes[route.id]) {
      delete likedRoutes[route.id];
    } else {
      likedRoutes[route.id] = route;
    }
  }

  function showSingleRoute(key) {
    if (activeRoute && !pinnedRoutes[activeRoute] && activeRouteLayer) {
      map.removeLayer(activeRouteLayer);
    }
    // Implementation for route visualization can be added here
    activeRoute = key;
  }

  function toggleTheme() {
    document.body.classList.toggle("dark");
    if (document.body.classList.contains("dark")) {
      map.removeLayer(lightLayer);
      darkLayer.addTo(map);
    } else {
      map.removeLayer(darkLayer);
      lightLayer.addTo(map);
    }
  }

  function locateMe() {
    if (!navigator.geolocation) {
      alert("Geolocation not supported.");
      return;
    }
    navigator.geolocation.getCurrentPosition(pos => {
      const { latitude, longitude } = pos.coords;
      L.marker([latitude, longitude]).addTo(map).bindPopup("You are here").openPopup();
      map.setView([latitude, longitude], 14);
    }, () => {
      alert("Unable to retrieve location.");
    });
  }

  function showLikedRoutes() {
    alert("Liked routes feature not implemented yet.");
  }

  // Search info in route.info
  function searchInfo(query) {
    const resultRoutes = [];
    if (!query.trim()) {
      console.log("Empty search, skipping.");
      return;
    }
    const terms = query.trim().split('-').map(t => t.trim());

    for (const type in routeData) {
      for (const group in routeData[type]) {
        for (const route of routeData[type][group]) {
          if (!route.info) continue;
          const infoStops = route.info.split('-').map(s => s.trim());

          let i = 0; // index in infoStops
          let matched = true;

          for (let j = 0; j < terms.length; j++) {
            const term = terms[j];
            let found = false;

            while (i < infoStops.length) {
              if (infoStops[i].includes(term)) {
                found = true;
                i++;
                break;
              }
              i++;
            }

            if (!found) {
              matched = false;
              break;
            }
          }

          if (matched) {
            resultRoutes.push(route);
          }
        }
      }
    }
    showInfoSearchResults(resultRoutes);
  }

  // Show search results with "‚ÑπÔ∏è Route Stops" buttons
  function showInfoSearchResults(routes) {
    let panel = document.getElementById('info-search-results');

    const inputBox = document.getElementById('info-search-box');
    const inputRect = inputBox.getBoundingClientRect();

    if (!panel) {
      panel = document.createElement('div');
      panel.id = 'info-search-results';
      panel.style.position = 'absolute';
      panel.style.right = '20px';
      document.body.appendChild(panel);
    }

    panel.style.top = `${inputRect.bottom + window.scrollY + 8}px`;
    panel.style.width = '300px';
    panel.style.maxHeight = '400px';
    panel.style.overflowY = 'auto';
    panel.style.background = 'white';
    panel.style.border = '1px solid #ccc';
    panel.style.borderRadius = '10px';
    panel.style.boxShadow = '0 2px 6px rgba(0,0,0,0.3)';
    panel.style.padding = '10px';
    panel.style.zIndex = '1005';

    panel.innerHTML = '';

    if (routes.length === 0) {
      panel.innerHTML = '<div>No matching routes found.</div>';
      return;
    }

    routes.forEach(route => {
      const card = document.createElement('div');
      card.style.padding = '10px';
      card.style.marginBottom = '10px';
      card.style.border = `2px solid ${route.color}`;
      card.style.borderRadius = '8px';
      card.style.background = '#f9f9f9';
      card.style.cursor = 'pointer';
      card.style.transition = 'background 0.2s ease';

      card.onmouseover = () => card.style.background = '#eef6ff';
      card.onmouseout = () => card.style.background = '#f9f9f9';

      // Route name and Info button
      const nameDiv = document.createElement('div');
      nameDiv.style.fontWeight = 'bold';
      nameDiv.style.fontSize = '15px';
      nameDiv.style.color = route.color;
      nameDiv.textContent = route.name;

      const infoBtn = document.createElement('button');
      infoBtn.textContent = '‚ÑπÔ∏è Route Stops';
      infoBtn.style.marginTop = '4px';
      infoBtn.style.padding = '6px 10px';
      infoBtn.style.border = 'none';
      infoBtn.style.borderRadius = '6px';
      infoBtn.style.background = '#007bff';
      infoBtn.style.color = 'white';
      infoBtn.style.cursor = 'pointer';

      infoBtn.onclick = () => {
        alert(`üìç Places on this route:\n${route.info || 'No info available.'}`);
      };

      // Append name and button
      const headerDiv = document.createElement('div');
      headerDiv.appendChild(nameDiv);
      headerDiv.appendChild(infoBtn);
      card.appendChild(headerDiv);

      // Build stops list for direction
      const stops = route.info ? route.info.split('-').map(s => s.trim()) : [];
      const directionDiv = document.createElement('div');
      directionDiv.style.fontSize = '12px';
      directionDiv.style.color = '#555';
      directionDiv.style.marginTop = '6px';
      if (stops.length > 0) {
        directionDiv.innerHTML = `Direction: ${stops[0]} ‚û°Ô∏è ${stops[stops.length - 1]}`;
      } else {
        directionDiv.innerHTML = `Direction: N/A`;
      }
      card.appendChild(directionDiv);

      // Show price if available
      if (route.price) {
        const priceDiv = document.createElement('div');
        priceDiv.innerHTML = `<div style="font-size: 13px; color: #555; margin-top: 4px;">Price: <strong>${route.price}</strong></div>`;
        card.appendChild(priceDiv);
      }

      // When clicking the entire card, show route on map
      card.onclick = () => {
        showSingleRoute(route.id);
        document.getElementById('info-search-results').style.display = 'none';

        // Optional: highlight in menu
        let foundType = null;
        for (const type in routeData) {
          for (const group in routeData[type]) {
            for (const r of routeData[type][group]) {
              if (r.id === route.id) {
                foundType = type;
                break;
              }
            }
            if (foundType) break;
          }
          if (foundType) {
            openMenu(foundType);
            // Scroll into view
            setTimeout(() => {
              const menuPanel = document.getElementById('menu-content-panel');
              const routeCards = [...menuPanel.querySelectorAll('.route-card')];
              for (const c of routeCards) {
                if (c.getAttribute('data-name') === route.name.toLowerCase()) {
                  c.scrollIntoView({ behavior: 'smooth', block: 'start' });
                  c.style.outline = '2px solid #007bff';
                  setTimeout(() => c.style.outline = 'none', 1200);
                  break;
                }
              }
            }, 200);
          }
        }
      };

      panel.appendChild(card);
    });
  }

  function clearSearch() {
    document.getElementById('info-search-box').value = '';
    document.getElementById('info-results').style.display = 'none';
  }

  function clearFromTo() {
    document.getElementById('from-input').value = '';
    document.getElementById('to-input').value = '';
    document.getElementById('from-to-result-panel').style.display = 'none';
  }

  function searchFromTo() {
    const from = document.getElementById('from-input').value.trim();
    const to = document.getElementById('to-input').value.trim();
    const panel = document.getElementById('from-to-result-panel');
    const content = document.getElementById('from-to-result-content');

    panel.style.display = 'block';
    content.innerHTML = '';

    if (!from || !to) {
      content.innerHTML = '<div>Please enter both "From" and "To".</div>';
      return;
    }

    const allRoutes = [];

    for (const type in routeData) {
      for (const group in routeData[type]) {
        for (const route of routeData[type][group]) {
          if (!route.info) continue;
          const stops = route.info.split('-').map(s => s.trim());
          allRoutes.push({ ...route, stops });
        }
      }
    }

    const results = [];

    // Same route
    for (const route of allRoutes) {
      const fromIdx = route.stops.findIndex(s => s.includes(from));
      const toIdx = route.stops.findIndex(s => s.includes(to));
      if (fromIdx !== -1 && toIdx !== -1 && fromIdx < toIdx) {
        results.push([route]);
      }
    }

    // Across two routes
    for (const route1 of allRoutes) {
      const fromIdx = route1.stops.findIndex(s => s.includes(from));
      if (fromIdx === -1) continue;
      for (let i = fromIdx + 1; i < route1.stops.length; i++) {
        const junction = route1.stops[i];
        for (const route2 of allRoutes) {
          if (route2.id === route1.id) continue;
          const junctionIdx = route2.stops.findIndex(s => s.includes(junction));
          const toIdx = route2.stops.findIndex(s => s.includes(to));
          if (junctionIdx !== -1 && toIdx !== -1 && junctionIdx < toIdx) {
            results.push([route1, route2]);
          }
        }
      }
    }

    if (results.length === 0) {
      content.innerHTML = '<div>No connected route found.</div>';
      return;
    }

    results.forEach(chain => {
      const wrapper = document.createElement('div');
      wrapper.style.marginBottom = '10px';
      wrapper.style.padding = '8px';
      wrapper.style.border = '1px solid #ccc';
      wrapper.style.borderRadius = '6px';
      wrapper.style.background = '#f9f9f9';

      chain.forEach(route => {
        const card = document.createElement('div');
        card.style.marginBottom = '6px';
        card.style.borderLeft = `4px solid ${route.color}`;
        card.style.paddingLeft = '8px';
        card.style.cursor = 'pointer';
        card.innerHTML = `
          <div style="font-weight: bold; color: ${route.color}; font-size: 15px;">${route.name}</div>
          <div style="font-size: 13px;">${route.info}</div>
        `;
        card.onclick = () => {
          showSingleRoute(route.id);
          document.getElementById('from-to-result-panel').style.display='none';
        };
        wrapper.appendChild(card);
      });

      content.appendChild(wrapper);
    });
  }

</script>
</body>
</html>
